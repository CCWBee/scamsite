# =============================================================================
# ScamAware Jersey Guardrails Service - Pre-commit Configuration
# =============================================================================
#
# Pre-commit is a framework for managing and maintaining multi-language
# pre-commit hooks. It runs checks on your code before each commit, ensuring
# code quality standards are maintained consistently across the team.
#
# ----------------------------- SETUP INSTRUCTIONS -----------------------------
#
# 1. Install pre-commit (if not already installed):
#    pip install pre-commit
#
# 2. Install the git hooks in your local repository:
#    pre-commit install
#
#    This creates a .git/hooks/pre-commit file that runs these checks
#    automatically before each commit.
#
# 3. (Optional) Run hooks on all files manually:
#    pre-commit run --all-files
#
# 4. (Optional) Update hooks to latest versions:
#    pre-commit autoupdate
#
# ----------------------------- WHY PRE-COMMIT? --------------------------------
#
# - Catches issues BEFORE they enter the codebase
# - Ensures consistent code style across all contributors
# - Prevents common bugs and security issues
# - Saves time in code reviews by automating style checks
# - Reduces CI/CD failures due to formatting issues
#
# =============================================================================

# Minimum pre-commit version required
minimum_pre_commit_version: '3.0.0'

# Default settings applied to all hooks unless overridden
default_language_version:
  python: python3.11

# Only run hooks on staged files by default (not all files)
# This makes commits faster and focuses on what's being changed
# Note: 'pre-commit' is the modern stage name (replaces deprecated 'commit')
default_stages: [pre-commit]

# Repository definitions and their hooks
repos:
  # ===========================================================================
  # BLACK - The Uncompromising Code Formatter
  # ===========================================================================
  #
  # Black is an opinionated Python code formatter that enforces a consistent
  # style across your entire codebase. It reformats entire files in place.
  #
  # WHY BLACK?
  # - Eliminates debates about code style in code reviews
  # - Produces deterministic output (same input = same output)
  # - Integrates with most editors for format-on-save
  # - Line length of 88 is optimal for side-by-side diffs
  #
  # Black will reformat code to match PEP 8 with sensible defaults.
  # Example transformations:
  #   - Consistent quote usage (double quotes for strings)
  #   - Proper line wrapping for long lines
  #   - Consistent spacing around operators
  #   - Normalized trailing commas in collections
  #
  - repo: https://github.com/psf/black
    rev: 24.4.2  # Use the latest stable version
    hooks:
      - id: black
        name: black (code formatter)
        description: "Formats Python code to ensure consistent style"
        # Only process Python files
        types: [python]
        # Additional arguments can be added here
        # args: ['--check']  # Uncomment to only check without modifying
        language_version: python3.11

  # ===========================================================================
  # RUFF - Extremely Fast Python Linter
  # ===========================================================================
  #
  # Ruff is a blazingly fast Python linter written in Rust. It replaces
  # multiple tools (flake8, isort, pyupgrade, and more) with a single,
  # unified tool that's 10-100x faster.
  #
  # WHY RUFF?
  # - Speed: Lints entire codebases in milliseconds
  # - Unified: Replaces flake8, isort, pyupgrade, and more
  # - Auto-fix: Can automatically fix many issues
  # - Modern: Built for Python 3.11+ with modern best practices
  #
  # Rule sets enabled (configured in ruff.toml):
  # - E: pycodestyle errors (PEP 8 style guide)
  # - F: Pyflakes (logical errors, unused imports)
  # - I: isort (import sorting)
  # - UP: pyupgrade (modernize syntax for newer Python)
  # - B: flake8-bugbear (common bug patterns)
  #
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.4.4  # Use the latest stable version
    hooks:
      # Ruff linter - catches errors and style issues
      - id: ruff
        name: ruff (linter)
        description: "Fast Python linter - catches errors, style issues, and bugs"
        types: [python]
        # --fix allows ruff to auto-fix issues where possible
        # --exit-non-zero-on-fix ensures the hook fails if fixes were applied
        # (so you can review the changes before committing)
        args: ['--fix', '--exit-non-zero-on-fix']

      # Ruff formatter - alternative to black (optional, we use black instead)
      # Uncomment if you want to use ruff's formatter instead of black
      # - id: ruff-format
      #   name: ruff-format (formatter)
      #   types: [python]

  # ===========================================================================
  # MYPY - Static Type Checker
  # ===========================================================================
  #
  # Mypy is a static type checker for Python. It analyzes your code to find
  # type errors without running it, catching bugs before they reach production.
  #
  # WHY MYPY?
  # - Catches type-related bugs at development time
  # - Improves code documentation through type hints
  # - Enables better IDE support (autocomplete, refactoring)
  # - Makes large codebases easier to maintain
  # - Required for strict type safety in API services
  #
  # In strict mode (configured in mypy.ini), mypy requires:
  # - Type annotations on all function signatures
  # - No implicit Any types
  # - Proper handling of Optional types
  #
  # Example errors mypy catches:
  #   def greet(name: str) -> str:
  #       return name.upper()
  #   greet(123)  # Error: Argument 1 has incompatible type "int"
  #
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.10.0  # Use the latest stable version
    hooks:
      - id: mypy
        name: mypy (type checker)
        description: "Static type checker - ensures type safety"
        types: [python]
        # Additional type stubs for common libraries
        # These provide type information for third-party packages
        additional_dependencies:
          - 'pydantic>=2.0.0'
          - 'fastapi>=0.109.0'
          - 'types-requests'
          - 'httpx>=0.26.0'
        # Pass explicit config file location
        args: ['--config-file=mypy.ini']
        # Don't pass filenames - let mypy use its own file discovery
        # This avoids issues with imports between files
        pass_filenames: false

  # ===========================================================================
  # GENERAL PRE-COMMIT HOOKS
  # ===========================================================================
  #
  # These are general-purpose hooks that catch common issues across all
  # file types, not just Python.
  #
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      # Prevents giant files from being committed (default 500KB)
      - id: check-added-large-files
        name: check for large files
        description: "Prevents accidentally committing large files"
        args: ['--maxkb=500']

      # Checks for files that would conflict on case-insensitive filesystems
      - id: check-case-conflict
        name: check for case conflicts
        description: "Prevents filename case conflicts (Windows compatibility)"

      # Ensures files end with a newline (POSIX standard)
      - id: end-of-file-fixer
        name: fix end of files
        description: "Ensures files end with a newline"
        types: [python]

      # Removes trailing whitespace (cleaner diffs, prevents issues)
      - id: trailing-whitespace
        name: trim trailing whitespace
        description: "Removes trailing whitespace from lines"
        types: [python]

      # Validates YAML syntax
      - id: check-yaml
        name: check yaml syntax
        description: "Validates YAML file syntax"

      # Validates TOML syntax
      - id: check-toml
        name: check toml syntax
        description: "Validates TOML file syntax"

      # Detects private keys accidentally committed
      - id: detect-private-key
        name: detect private keys
        description: "Prevents accidentally committing private keys"

      # Checks for merge conflict markers
      - id: check-merge-conflict
        name: check for merge conflicts
        description: "Prevents committing unresolved merge conflicts"

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# Q: Hook is failing but I need to commit anyway?
# A: Use: git commit --no-verify (use sparingly!)
#
# Q: Hooks are slow?
# A: They only run on staged files. For full checks: pre-commit run --all-files
#
# Q: How do I skip a specific hook?
# A: Use: SKIP=hook-id git commit -m "message"
#    Example: SKIP=mypy git commit -m "WIP: work in progress"
#
# Q: How do I update hooks to latest versions?
# A: Run: pre-commit autoupdate
#
# Q: mypy is complaining about missing imports?
# A: Add the package to additional_dependencies above, or configure
#    ignore_missing_imports in mypy.ini for that module.
#
# =============================================================================
