# =============================================================================
# ScamAware Jersey Guardrails Service - MyPy Configuration
# =============================================================================
#
# MyPy is a static type checker for Python. It analyzes your code's type
# annotations to catch type errors before runtime, making your code safer
# and more maintainable.
#
# This configuration enables strict mode with some practical relaxations
# for third-party libraries that may not have complete type stubs.
#
# Documentation: https://mypy.readthedocs.io/en/stable/config_file.html
#
# =============================================================================

[mypy]
# -----------------------------------------------------------------------------
# PYTHON VERSION
# -----------------------------------------------------------------------------

# Target Python version for type checking
# This affects which features and type constructs are available
python_version = 3.11

# Enable pydantic plugin for better type inference with Pydantic models
plugins = pydantic.mypy

# -----------------------------------------------------------------------------
# STRICT MODE SETTINGS
# -----------------------------------------------------------------------------
# These settings enable comprehensive type checking for maximum safety.
# Strict mode catches more bugs but requires more complete type annotations.

# Disallow functions without type annotations
# Forces you to add types to all function signatures
# Example: def process(data) -> BAD, def process(data: str) -> str: GOOD
disallow_untyped_defs = True

# Disallow calling functions without type annotations
# Ensures you're not bypassing type safety by calling untyped code
disallow_untyped_calls = True

# Disallow incomplete function definitions (partial annotations)
# Either annotate everything or nothing - no partial annotations
disallow_incomplete_defs = True

# Check inside functions even if they have no annotations
# Useful for catching issues in legacy code
check_untyped_defs = True

# Disallow decorators that don't preserve type information
# Encourages use of properly typed decorators
disallow_untyped_decorators = True

# -----------------------------------------------------------------------------
# ANY TYPE RESTRICTIONS
# -----------------------------------------------------------------------------
# The 'Any' type is an escape hatch that bypasses type checking.
# These settings help prevent overuse of Any.

# Disallow expressions that have an 'Any' type
# This catches cases where type information is lost
# Note: disallow_any_expr is too strict for practical use, so we leave it disabled (default)

# Disallow generic types without type parameters
# Example: List -> BAD, List[str] -> GOOD
disallow_any_generics = True

# Disallow subclassing 'Any'
# Prevents type information from being lost in inheritance
disallow_subclassing_any = True

# -----------------------------------------------------------------------------
# WARNING SETTINGS
# -----------------------------------------------------------------------------

# Warn about unused '# type: ignore' comments
# Helps clean up annotations when issues are fixed
warn_unused_ignores = True

# Warn when a function returns Any unintentionally
# Catches cases where type information is lost in return values
warn_return_any = True

# Warn about unreachable code
# Catches logic errors like code after return statements
warn_unreachable = True

# Warn when comparing None using == instead of 'is'
# 'is None' is more Pythonic and explicit
warn_redundant_casts = True

# -----------------------------------------------------------------------------
# NONE AND OPTIONAL HANDLING
# -----------------------------------------------------------------------------

# Enable strict checking of Optional types
# Ensures you handle None cases explicitly
strict_optional = True

# Don't allow implicit Optional for arguments with None default
# Forces explicit Optional[T] annotation
no_implicit_optional = True

# -----------------------------------------------------------------------------
# ERROR MESSAGE SETTINGS
# -----------------------------------------------------------------------------

# Show error codes in messages (e.g., [arg-type])
# Makes it easier to add targeted '# type: ignore[code]' comments
show_error_codes = True

# Show column numbers in error messages
# Helps pinpoint exactly where the error is
show_column_numbers = True

# Use pretty output format with source context
# Makes errors easier to understand
pretty = True

# Color output for better readability
color_output = True

# Show detailed error messages
# Includes more context about what went wrong
show_error_context = True

# -----------------------------------------------------------------------------
# MODULE DISCOVERY
# -----------------------------------------------------------------------------

# Enable namespace packages (PEP 420)
# Allows packages without __init__.py files
namespace_packages = True

# Warn about missing return statements in typed functions
# Catches forgotten returns that would return None implicitly
warn_no_return = True

# -----------------------------------------------------------------------------
# THIRD-PARTY LIBRARY SETTINGS
# -----------------------------------------------------------------------------
# Many third-party libraries don't have complete type stubs.
# We configure mypy to be lenient with these while strict with our code.

# Ignore errors from imports that can't be found
# This is necessary for libraries without type stubs
# Set to True initially, then gradually disable as you add stubs
ignore_missing_imports = True

# -----------------------------------------------------------------------------
# PER-MODULE OVERRIDES
# -----------------------------------------------------------------------------
# Configure specific settings for different modules

# FastAPI - has good type support
[mypy-fastapi.*]
ignore_missing_imports = False

# Pydantic - has excellent type support with plugin
[mypy-pydantic.*]
ignore_missing_imports = False

# HTTPX - has good type support
[mypy-httpx.*]
ignore_missing_imports = False

# Uvicorn - may have incomplete stubs
[mypy-uvicorn.*]
ignore_missing_imports = True

# Test files - can be slightly more relaxed
[mypy-tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False

# =============================================================================
# COMMON ERROR CODES REFERENCE
# =============================================================================
#
# [arg-type]         Argument has incompatible type
# [return-value]     Incompatible return value type
# [assignment]       Incompatible types in assignment
# [attr-defined]     Module/class has no attribute
# [name-defined]     Name is not defined
# [import]           Cannot find module
# [override]         Signature incompatible with supertype
# [misc]             Miscellaneous errors
# [no-untyped-def]   Function is missing type annotations
# [union-attr]       Item of union has no attribute
#
# To ignore a specific error on a line:
#   result = some_function()  # type: ignore[return-value]
#
# =============================================================================
# RUNNING MYPY
# =============================================================================
#
# Check all files:
#   mypy .
#
# Check specific file:
#   mypy path/to/file.py
#
# Check with verbose output:
#   mypy . --verbose
#
# Show all errors (no limit):
#   mypy . --no-error-summary
#
# Generate HTML report:
#   mypy . --html-report reports/mypy
#
# =============================================================================
